@using Famick.HomeManagement.Core.DTOs.ShoppingLists
@inject ILocalizer L

<MudPaper Elevation="0"
          Class="@($"pa-3 mb-2 {(Item.IsPurchased ? "purchased-item" : "")}")"
          Style="@(Item.IsPurchased ? "background-color: var(--mud-palette-background-grey); opacity: 0.7;" : "")">
    <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
        <MudTooltip Text="@(CanEdit ? null : L["common.viewerNoPermission"])" Disabled="@CanEdit">
            <MudCheckBox T="bool"
                         Value="@Item.IsPurchased"
                         ValueChanged="@OnCheckedChanged"
                         Color="Color.Success"
                         Disabled="@(!CanEdit || IsLoading)"
                         Size="Size.Medium" />
        </MudTooltip>

        <MudStack Spacing="0" Class="flex-grow-1">
            <MudText Typo="Typo.body1"
                     Style="@(Item.IsPurchased ? "text-decoration: line-through; color: var(--mud-palette-text-secondary);" : "font-weight: 500;")">
                @(Item.ProductName ?? "Unknown Product")
            </MudText>

            <MudStack Row="true" Spacing="2" AlignItems="AlignItems.Center">
                @if (Item.Amount > 0 && !string.IsNullOrEmpty(Item.QuantityUnitName))
                {
                    <MudText Typo="Typo.body2" Color="Color.Secondary">
                        @Item.Amount @Item.QuantityUnitName
                    </MudText>
                }
                else if (Item.Amount > 0)
                {
                    <MudText Typo="Typo.body2" Color="Color.Secondary">
                        x@Item.Amount
                    </MudText>
                }

                @if (Item.Price.HasValue)
                {
                    <MudText Typo="Typo.body2" Color="Color.Secondary">
                        $@Item.Price.Value.ToString("F2")
                    </MudText>
                }
            </MudStack>

            @if (!string.IsNullOrEmpty(Item.Note))
            {
                <MudText Typo="Typo.caption" Color="Color.Secondary" Class="mt-1">
                    @Item.Note
                </MudText>
            }
        </MudStack>

        @if (!string.IsNullOrEmpty(Item.ImageUrl))
        {
            <MudAvatar Size="Size.Medium" Rounded="true">
                <MudImage Src="@Item.ImageUrl" Alt="@Item.ProductName" />
            </MudAvatar>
        }
    </MudStack>
</MudPaper>

@code {
    [Parameter, EditorRequired]
    public ShoppingListItemDto Item { get; set; } = null!;

    [Parameter]
    public bool CanEdit { get; set; } = true;

    [Parameter]
    public bool IsLoading { get; set; }

    [Parameter]
    public EventCallback<bool> OnPurchasedChanged { get; set; }

    private async Task OnCheckedChanged(bool newValue)
    {
        await OnPurchasedChanged.InvokeAsync(newValue);
    }
}
